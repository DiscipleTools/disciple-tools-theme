import{i as t,y as e}from"../../lit-element-2409d5fe.js";import{i}from"../../style-map-ac85d91b.js";import{o as s}from"../../map-c0e24c36.js";import{D as o}from"../dt-tags/dt-tags.js";import"../../directive-de55b00a.js";import"../../lit-localize-763e4978.js";import"../dt-multi-select/dt-multi-select.js";import"../dt-form-base.js";import"../../dt-base.js";import"../dt-label/dt-label.js";import"../../icons/dt-spinner.js";import"../../icons/dt-checkmark.js";window.customElements.define("dt-location",class extends o{static get properties(){return{...super.properties,filters:{type:Array},mapboxKey:{type:String},dtMapbox:{type:Object}}}static get styles(){return[...super.styles,t`.input-group{display:flex}.field-container{position:relative}select{border:1px solid var(--dt-form-border-color,#cacaca);outline:0}.selected-option>:first-child{max-width:calc(var(--container-width) - var(--select-width) - var(--container-padding) - var(--option-padding) - var(--option-button) - 8px)}`]}updated(){super.updated();const t=this.shadowRoot.querySelector(".input-group");if(!t.style.getPropertyValue("--select-width")){const e=this.shadowRoot.querySelector("select");t.style.setProperty("--select-width",`${e.clientWidth}px`)}}_filterOptions(){const t=(this.value||[]).filter((t=>!t.delete)).map((t=>t?.id));if(this.options?.length)this.filteredOptions=(this.options||[]).filter((e=>!t.includes(e.id)&&(!this.query||e.label.toLocaleLowerCase().includes(this.query.toLocaleLowerCase()))));else{this.loading=!0,this.filteredOptions=[];const e=this,i=this.shadowRoot.querySelector("select"),s=new CustomEvent("load",{bubbles:!0,detail:{field:this.name,query:this.query,filter:i?.value,onSuccess:i=>{e.loading=!1,e.filteredOptions=i.filter((e=>!t.includes(e.id)))},onError:t=>{console.warn(t),e.loading=!1}}});this.dispatchEvent(s)}return this.filteredOptions}render(){const t={display:this.open?"block":"none",top:`${this.containerHeight}px`};return this.mapboxKey?e`${this.labelTemplate()}<div id="mapbox-wrapper"><div id="mapbox-autocomplete" class="mapbox-autocomplete input-group" data-autosubmit="true" data-add-address="true"><input id="mapbox-search" type="text" name="mapbox_search" class="input-group-field" autocomplete="off" dir="auto" placeholder="Search Location"><div class="input-group-button"><button id="mapbox-spinner-button" class="button hollow" style="display:none;border-color:#d3d3d3"><span style="border-radius:50%;width:24px;height:24px;border:.25rem solid #d3d3d3;border-top-color:#000;animation:spin 1s infinite linear;display:inline-block"></span></button> <button id="mapbox-clear-autocomplete" class="button alert input-height delete-button-style mapbox-delete-button" type="button" title="Clear" style="display:none">Ã—</button></div><div id="mapbox-autocomplete-list" class="mapbox-autocomplete-items"></div></div><div id="location-grid-meta-results"></div></div>`:e`${this.labelTemplate()}<div class="input-group ${this.disabled?"disabled":""}"><div class="field-container" @click="${this._focusInput}" @keydown="${this._focusInput}">${this._renderSelectedOptions()} <input type="text" placeholder="${this.placeholder}" @focusin="${this._inputFocusIn}" @blur="${this._inputFocusOut}" @keydown="${this._inputKeyDown}" @keyup="${this._inputKeyUp}" ?disabled="${this.disabled}"> ${this.loading?e`<dt-spinner class="icon-overlay"></dt-spinner>`:null} ${this.saved?e`<dt-checkmark class="icon-overlay success"></dt-checkmark>`:null}</div><select class="filter-list" ?disabled="${this.disabled}">${s(this.filters,(t=>e`<option value="${t.id}">${t.label}</option>`))}</select><ul class="option-list" style="${i(t)}">${this._renderOptions()}</ul></div>`}});
