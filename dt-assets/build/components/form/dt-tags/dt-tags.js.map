{"version":3,"file":"dt-tags.js","sources":["../../../src/components/form/dt-tags/dt-tags.js"],"sourcesContent":["import { css, html } from 'lit';\nimport { DtMultiSelect } from '../dt-multi-select/dt-multi-select.js';\n\nexport class DtTags extends DtMultiSelect {\n  static get properties() {\n    return {\n      ...super.properties,\n      allowAdd: { type: Boolean },\n      onload: { type: String },\n    };\n  }\n\n  static get styles() {\n    return [\n      ...super.styles,\n      css`\n        .selected-option a,\n        .selected-option a:active,\n        .selected-option a:visited {\n          text-decoration: none;\n          color: var(--primary-color, #3f729b);\n        }\n      `,\n    ];\n  }\n\n  willUpdate(props) {\n    super.willUpdate(props);\n\n    if (props) {\n      const openChanged = props.has('open');\n      // When list is first opened and we don't have any options yet,\n      // trigger _filterOptions to load options\n      if (openChanged && this.open && (!this.filteredOptions || !this.filteredOptions.length)) {\n        this._filterOptions();\n      }\n    }\n  }\n\n  /**\n   * Filter to options that:\n   *   1: are not selected\n   *   2: match the search query\n   * @private\n   */\n  _filterOptions() {\n    const selectedValues = (this.value || [])\n      .filter(i => !i.startsWith('-'));\n\n    if (this.options?.length) {\n      this.filteredOptions = (this.options || []).filter(\n        opt =>\n          !selectedValues.includes(opt.id) &&\n          (!this.query ||\n            opt.id\n              .toLocaleLowerCase()\n              .includes(this.query.toLocaleLowerCase()))\n      );\n    } else if (this.open || this.canUpdate) {\n      // Only run this filtering if the list is open.\n      // This prevents it from running on initial load before a `load` event is attached.\n      this.loading = true;\n      this.filteredOptions = [];\n\n      // need to fetch data via API request\n      const self = this;\n      const event = new CustomEvent('dt:get-data', {\n        bubbles: true,\n        detail: {\n          field: this.name,\n          postType: this.postType,\n          query: this.query,\n          onSuccess: result => {\n            self.loading = false;\n\n            // if given an array of strings, transform to object array\n            let options = result;\n            if (options.length && typeof options[0] === 'string') {\n              options = options.map(o => ({\n                id: o,\n              }));\n            }\n\n            self.allOptions = options;\n            // filter out selected values from list\n            self.filteredOptions = options.filter(\n              opt => !selectedValues.includes(opt.id)\n            );\n          },\n          onError: error => {\n            console.warn(error);\n            self.loading = false;\n            this.canUpdate = false;\n          },\n        },\n      });\n      this.dispatchEvent(event);\n    }\n    return this.filteredOptions;\n  }\n\n  _renderOption(opt, idx) {\n    return html`\n      <li tabindex=\"-1\">\n        <button\n          value=\"${opt.id}\"\n          type=\"button\"\n          data-label=\"${opt.label}\"\n          @click=\"${this._clickOption}\"\n          @touchstart=\"${this._touchStart}\"\n          @blur=\"${this._inputFocusOut}\"\n          @touchmove=\"${this._touchMove}\"\n          @touchend=\"${this._touchEnd}\"\n          tabindex=\"-1\"\n          class=\"${this.activeIndex > -1 && this.activeIndex === idx\n      ? 'active'\n      : ''}\"\n        >\n          ${opt.label || opt.id}\n        </button>\n      </li>\n    `;\n  }\n\n  _renderSelectedOptions() {\n    const options = this.options || this.allOptions;\n    return (this.value || [])\n      .filter(i => !i.startsWith('-'))\n      .map(\n        tag => {\n          let label = tag;\n          if (options) {\n            const option = options.filter(o => o === tag || o.id === tag);\n            if (option.length) {\n              label = option[0].label || option[0].id || tag;\n            }\n          }\n          let link;\n          if (!link && window?.SHAREDFUNCTIONS?.createCustomFilter) {\n            const query =  window.SHAREDFUNCTIONS.createCustomFilter(this.name, [tag])\n            const fieldLabel = this.label || this.name\n            const labels = [{ id: `${this.name}_${tag}`, name: `${fieldLabel}: ${tag}`}]\n            link = window.SHAREDFUNCTIONS.create_url_for_list_query(this.postType, query, labels);\n          }\n          return html`\n          <div class=\"selected-option\">\n            <a\n              href=\"${link || '#'}\"\n              ?disabled=\"${this.disabled}\"\n              alt=\"${tag}\"\n              >${label}</a\n            >\n            <button\n              @click=\"${this._remove}\"\n              ?disabled=\"${this.disabled}\"\n              data-value=\"${tag}\"\n            >\n              x\n            </button>\n          </div>\n        `}\n      );\n  }\n}\n\nwindow.customElements.define('dt-tags', DtTags);\n"],"names":["DtTags","DtMultiSelect","properties","super","allowAdd","type","Boolean","onload","String","styles","css","willUpdate","props","has","this","open","filteredOptions","length","_filterOptions","selectedValues","value","filter","i","startsWith","options","opt","includes","id","query","toLocaleLowerCase","canUpdate","loading","self","event","CustomEvent","bubbles","detail","field","name","postType","onSuccess","result","map","o","allOptions","onError","error","console","warn","dispatchEvent","_renderOption","idx","html","label","_clickOption","_touchStart","_inputFocusOut","_touchMove","_touchEnd","activeIndex","_renderSelectedOptions","tag","link","option","window","SHAREDFUNCTIONS","createCustomFilter","fieldLabel","labels","create_url_for_list_query","disabled","_remove","customElements","define"],"mappings":"gaAGO,MAAMA,UAAeC,EACfC,wBACT,MAAO,IACFC,MAAMD,WACTE,SAAU,CAAEC,KAAMC,SAClBC,OAAQ,CAAEF,KAAMG,QAEnB,CAEUC,oBACT,MAAO,IACFN,MAAMM,OACTC,CAAG,mIASN,CAEDC,WAAWC,GAGT,GAFAT,MAAMQ,WAAWC,GAEbA,EAAO,EACWA,EAAMC,IAAI,UAGXC,KAAKC,MAAUD,KAAKE,iBAAoBF,KAAKE,gBAAgBC,QAC9EH,KAAKI,gBAER,CACF,CAQDA,iBACE,MAAMC,GAAkBL,KAAKM,OAAS,IACnCC,QAAOC,IAAMA,EAAEC,WAAW,OAE7B,GAAIT,KAAKU,SAASP,OAChBH,KAAKE,iBAAmBF,KAAKU,SAAW,IAAIH,QAC1CI,IACGN,EAAeO,SAASD,EAAIE,OAC3Bb,KAAKc,OACLH,EAAIE,GACDE,oBACAH,SAASZ,KAAKc,MAAMC,6BAExB,GAAIf,KAAKC,MAAQD,KAAKgB,UAAW,CAGtChB,KAAKiB,SAAU,EACfjB,KAAKE,gBAAkB,GAGvB,MAAMgB,EAAOlB,KACPmB,EAAQ,IAAIC,YAAY,cAAe,CAC3CC,SAAS,EACTC,OAAQ,CACNC,MAAOvB,KAAKwB,KACZC,SAAUzB,KAAKyB,SACfX,MAAOd,KAAKc,MACZY,UAAWC,IACTT,EAAKD,SAAU,EAGf,IAAIP,EAAUiB,EACVjB,EAAQP,QAAgC,iBAAfO,EAAQ,KACnCA,EAAUA,EAAQkB,KAAIC,IAAM,CAC1BhB,GAAIgB,OAIRX,EAAKY,WAAapB,EAElBQ,EAAKhB,gBAAkBQ,EAAQH,QAC7BI,IAAQN,EAAeO,SAASD,EAAIE,KACrC,EAEHkB,QAASC,IACPC,QAAQC,KAAKF,GACbd,EAAKD,SAAU,EACfjB,KAAKgB,WAAY,CAAK,KAI5BhB,KAAKmC,cAAchB,EACpB,CACD,OAAOnB,KAAKE,eACb,CAEDkC,cAAczB,EAAK0B,GACjB,OAAOC,CAAI,oCAGI3B,EAAIE,iCAECF,EAAI4B,kBACRvC,KAAKwC,8BACAxC,KAAKyC,uBACXzC,KAAK0C,+BACA1C,KAAK2C,0BACN3C,KAAK4C,mCAET5C,KAAK6C,aAAe,GAAK7C,KAAK6C,cAAgBR,EACzD,SACA,OAEI1B,EAAI4B,OAAS5B,EAAIE,kBAI1B,CAEDiC,yBACE,MAAMpC,EAAUV,KAAKU,SAAWV,KAAK8B,WACrC,OAAQ9B,KAAKM,OAAS,IACnBC,QAAOC,IAAMA,EAAEC,WAAW,OAC1BmB,KACCmB,IACE,IAOIC,EAPAT,EAAQQ,EACZ,GAAIrC,EAAS,CACX,MAAMuC,EAASvC,EAAQH,QAAOsB,GAAKA,IAAMkB,GAAOlB,EAAEhB,KAAOkC,IACrDE,EAAO9C,SACToC,EAAQU,EAAO,GAAGV,OAASU,EAAO,GAAGpC,IAAMkC,EAE9C,CAED,IAAKC,GAAQE,QAAQC,iBAAiBC,mBAAoB,CACxD,MAAMtC,EAASoC,OAAOC,gBAAgBC,mBAAmBpD,KAAKwB,KAAM,CAACuB,IAC/DM,EAAarD,KAAKuC,OAASvC,KAAKwB,KAChC8B,EAAS,CAAC,CAAEzC,GAAI,GAAGb,KAAKwB,QAAQuB,IAAOvB,KAAM,GAAG6B,MAAeN,MACrEC,EAAOE,OAAOC,gBAAgBI,0BAA0BvD,KAAKyB,SAAUX,EAAOwC,EAC/E,CACD,OAAOhB,CAAI,yCAGCU,GAAQ,mBACHhD,KAAKwD,kBACXT,MACJR,yBAGOvC,KAAKyD,uBACFzD,KAAKwD,yBACJT,qBAAG,GAO5B,EAGHG,OAAOQ,eAAeC,OAAO,UAAWzE"}